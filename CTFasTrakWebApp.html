<!DOCTYPE html>
<html>
  <head>
    <style>
       #map {
        height: 600px;
        width: 80%;
       }
    </style>
  </head>
  <body>
    <div id="map"></div>
	
	<form name = "userInput">
	  <table>
		<tr>
	      <td>Enter current location:</td>
		  <td> <input type=text name=start size=30> <td>
		  <td><input type=button value="GO!" onClick="displayUserStartStopLoc()"</td>
		</tr>
		<tr>
		  <td>Enter destination location:</td>
		  <td><input type=text name=end size=30></td>			
    	</tr>
	    <tr>
		  <td>Enter a search radius</td>
		  <td><input type=text name=radius size=30><td>
		  <td><input type=button value="save radius" onClick="setRadius()"></td>
	    </tr>		
        <tr>
		<td><input type=button value="See All Busses" onClick=""</td>
	    </tr>
		<tr>
		  <td><input type=button value="See Bus Stops Close to Start" onClick=""></td>
		  <td><input type=text name=distance size = 12></td>				
  	    </tr>
	    <tr>
	    </tr>
	  </table>
	</form>
	
	<p id="testing"> </p>
	
	<script>
		var theMap  //global
		var radius
	
	  	function initMap() {
		  var cent = {lat: 41.635768, lng: -72.787725};
		  theMap = new google.maps.Map(document.getElementById('map'), {
		    zoom: 9,
		    center: cent,
		    mapTypeId: 'terrain' 
		  }); 
	    }
		
		
	    //String fileName must be one of ["agency", "calendar", "calendar_dates", "routes", "shapes", "stop_times", "stops", "trips"]
	    //will return an object containing 
	    function readStaticData(fileName){
		  var req = new XMLHttpRequest();
		  req.open('GET', 'https://raw.githubusercontent.com/jmluczy/TBDs-CTFasTrak-Project/static-data/version1/CTFasTrakStaticData/' + fileName + 'JSON.txt', false);
		  req.send(null);
		
		  if(req.status == 200){
		    var jsonString = req.responseText;		
		    var dataObj = JSON.parse(jsonString);     

		    return dataObj;
		  }
	    }
		
		//n must be an integer 0, 1, 2, 3 to indicate which of the live data streams to access
	    //will return an object containing the data from the feed specified
		function readRealTimeData(n){
		  var feedType = ['tripupdate/tripupdates', 'vehicle/vehiclepositions', 'alert/alerts', 'externalfeed/trapezerealtimefeed'];
		  var req = new XMLHttpRequest();
		  req.open('GET', 'http://65.213.12.244/realtimefeed/' + feedType[n] + '.json', false);
		  req.send(null);
		
		  if(req.status == 200){
		    var rawString = req.responseText;	
		    var dataObj = JSON.parse(rawString);
		    return dataObj;
		  }
	    }
		
		function displayUserStartStopLoc(){
		  var start = document.userInput.start.value;
		  var end   = document.userInput.end.value;
		  if (start != ""){ //if user entered something
		    update("in if block");
		    var startGeoCode = getGeoCode(start);
			var latLng = startGeoCode.results[0].geometry.location;
			addMarker(latLng, "START");
		  }
		  if (end != ""){
		    var endGeoCode = getGeoCode(end);
			var latLng = endGeoCode.results[0].geometry.location;
			addMarker(latLng, "END");
		  }
		}
		
		function getGeoCode(address){  
		  address = address.replace(" ", "+");
		  var req = new XMLHttpRequest();
		  req.open('GET', 'https://maps.googleapis.com/maps/api/geocode/json?address=' + address 
						+ '&key=AIzaSyBezkqLyMpXAF9dBb4X5rZeQkyF8Y5_Te4', false);
		  req.send(null);
		
		  if(req.status == 200){
		    var rawString = req.responseText;
		    var geoData = JSON.parse(rawString);
			update(geoData);
		  }
		  
		  return geoData;
		}
		
		function update(message){
		  var text = document.getElementById("testing").innerHTML;
		  text = text + "<br>" + message;
		  document.getElementById("testing").innerHTML = text;
	    }
		
		function addMarker(latLng, labelText){
		  var marker = new google.maps.Marker({
		    map: theMap,
			label: labelText,
			position: latLng
		  });
		}
		
		function setRadius(){
		  radius = document.userInput.radius.value * 1; //cast type to number
		}
		
		function distance(latLng1, latLng2){  
	      //both arguments MUST be LatLng objects i.e. {lat: double, lng: double}
		  var dist = google.maps.geometry.spherical.computeDistanceBetween(pos1, pos2); //in meters
		  dist = dist / 1609.34; //convert to miles
		  return dist;
	    }
		
		
	</script>
	
	<script async defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBezkqLyMpXAF9dBb4X5rZeQkyF8Y5_Te4&libraries=geometry&callback=initMap">
	</script>
  </body>
</html>